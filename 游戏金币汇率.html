<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æ¸¸æˆå¸ â†” RMB æ¢ç®—å·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      max-width: 600px;
      margin: auto;
    }
    input, select, button {
      padding: 8px;
      font-size: 16px;
      margin-bottom: 15px;
    }
    input, select {
      width: 100%;
      box-sizing: border-box;
    }
    .row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .row input {
      flex: 2;
    }
    .row select {
      flex: 1;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 6px;
    }
    #rate-display {
      color: #409EFF;
      font-weight: bold;
      margin-bottom: 20px;
      display: block;
    }
    button {
      width: 48%;
      cursor: pointer;
      background-color: #409EFF;
      border: none;
      color: white;
      border-radius: 4px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #66b1ff;
    }
    .btn-group {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    #log {
      border-top: 1px solid #ccc;
      padding-top: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 14px;
      color: #333;
    }
    #log h3 {
      margin-bottom: 10px;
    }
    .log-entry {
      margin-bottom: 8px;
      padding-bottom: 5px;
      border-bottom: 1px dashed #ddd;
    }
  </style>
</head>
<body>

  <h2>ğŸ® æ¸¸æˆå¸ â†” ğŸ’° RMB æ¢ç®—å·¥å…·</h2>

  <span id="rate-display">ğŸ’± å®é™…æ±‡ç‡ï¼š1 RMB = 560000 æ¸¸æˆå¸</span>

  <label for="rateBase">è®¾ç½®æ±‡ç‡ï¼ˆåŸºç¡€å€¼ + å•ä½ï¼‰ï¼š</label>
  <div class="row">
    <input type="number" id="rateBase" value="56" step="any" />
    <select id="rateUnit">
      <option value="1">æ— å•ä½</option>
      <option value="10000" selected>ä¸‡ (W)</option>
      <option value="100000000">äº¿ (E)</option>
    </select>
  </div>

  <label for="decimalPlaces">å°æ•°ä½æ•°ï¼ˆä¿ç•™å¤šå°‘ä½å°æ•°ï¼‰ï¼š</label>
  <input type="number" id="decimalPlaces" value="2" min="0" max="10" step="1" />

  <!-- æ¸¸æˆå¸æ•°é‡éƒ¨åˆ† -->
  <label for="game">ğŸ® æ¸¸æˆå¸æ•°é‡ï¼š</label>
  <div class="row">
    <input type="number" id="game" placeholder="è¾“å…¥æ¸¸æˆå¸æ•°é‡" step="any" />
    <select id="gameUnit">
      <option value="10000" selected>ä¸‡ (W)</option>
      <option value="1">æ— å•ä½</option>
      <option value="100000000">äº¿ (E)</option>
    </select>
  </div>

  <label for="rmb">ğŸ’µ RMB é‡‘é¢ï¼š</label>
  <input type="number" id="rmb" placeholder="è¾“å…¥äººæ°‘å¸é‡‘é¢" step="any" />

  <div class="btn-group">
    <button id="calcFromGame">ç”¨æ¸¸æˆå¸è®¡ç®— RMB</button>
    <button id="calcFromRMB">ç”¨ RMB è®¡ç®—æ¸¸æˆå¸</button>
  </div>

  <!-- è®¡ç®—è®°å½•æ˜¾ç¤ºåŒº -->
  <div id="log">
    <h3>ğŸ“ è®¡ç®—è®°å½•</h3>
  </div>

  <script>
    const rateBase = document.getElementById('rateBase');
    const rateUnit = document.getElementById('rateUnit');
    const decimalPlacesInput = document.getElementById('decimalPlaces');
    const gameInput = document.getElementById('game');
    const gameUnit = document.getElementById('gameUnit');
    const rmbInput = document.getElementById('rmb');
    const rateDisplay = document.getElementById('rate-display');
    const logDiv = document.getElementById('log');

    function getRate() {
      const base = parseFloat(rateBase.value);
      const unit = parseFloat(rateUnit.value);
      if (isNaN(base) || isNaN(unit)) return 0;
      return base * unit;
    }

    function getDecimalPlaces() {
      const val = parseInt(decimalPlacesInput.value);
      if (isNaN(val) || val < 0) return 2;
      if (val > 10) return 10; // æœ€å¤§é™åˆ¶10ä½
      return val;
    }

    function getGameValue() {
      const val = parseFloat(gameInput.value);
      const unit = parseFloat(gameUnit.value);
      if (isNaN(val) || isNaN(unit)) return 0;
      return val * unit;
    }

    function setGameValue(realValue) {
      const unit = parseFloat(gameUnit.value) || 10000; // é»˜è®¤å•ä½ä¸‡
      const decimals = getDecimalPlaces();
      // ä¸è‡ªåŠ¨æ¢å•ä½ï¼Œç›´æ¥ç”¨å½“å‰å•ä½è®¡ç®—æ˜¾ç¤º
      gameInput.value = (realValue / unit).toFixed(decimals);
    }

    function getRMBValue() {
      const val = parseFloat(rmbInput.value);
      if (isNaN(val)) return 0;
      return val;
    }

    function setRMBValue(val) {
      const decimals = getDecimalPlaces();
      rmbInput.value = val.toFixed(decimals);
    }

    function updateDisplayRate() {
      const rate = getRate();
      rateDisplay.textContent = `ğŸ’± å®é™…æ±‡ç‡ï¼š1 RMB = ${rate.toLocaleString()} æ¸¸æˆå¸`;
    }

    // æ–°å¢ï¼šè¿½åŠ ä¸€æ¡æ—¥å¿—
    function appendLog(message) {
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.textContent = message;
      logDiv.appendChild(entry);
      // æ»šåŠ¨åˆ°åº•éƒ¨
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function calculateRMBFromGame() {
      const rate = getRate();
      if (rate === 0) {
        alert('è¯·å…ˆè®¾ç½®æœ‰æ•ˆæ±‡ç‡ï¼');
        return;
      }
      const game = getGameValue();
      if (game === 0) {
        setRMBValue(0);
        return;
      }
      const rmb = game / rate;
      setRMBValue(rmb);

      // è¿½åŠ è®¡ç®—è®°å½•
      const decimals = getDecimalPlaces();
      appendLog(`æ±‡ç‡ï¼š1 RMB = ${rate.toLocaleString()} æ¸¸æˆå¸ï¼›ç”¨æ¸¸æˆå¸ ${gameInput.value} ${gameUnit.options[gameUnit.selectedIndex].text} è®¡ç®—ï¼Œå¾—å‡º RMB ${rmb.toFixed(decimals)}`);
    }

    function calculateGameFromRMB() {
      const rate = getRate();
      if (rate === 0) {
        alert('è¯·å…ˆè®¾ç½®æœ‰æ•ˆæ±‡ç‡ï¼');
        return;
      }
      const rmb = getRMBValue();
      if (rmb === 0) {
        gameInput.value = '';
        return;
      }
      const game = rmb * rate;
      setGameValue(game);

      // è¿½åŠ è®¡ç®—è®°å½•
      const decimals = getDecimalPlaces();
      appendLog(`æ±‡ç‡ï¼š1 RMB = ${rate.toLocaleString()} æ¸¸æˆå¸ï¼›ç”¨ RMB ${rmbInput.value} è®¡ç®—ï¼Œå¾—å‡ºæ¸¸æˆå¸ ${gameInput.value} ${gameUnit.options[gameUnit.selectedIndex].text}`);
    }

    function onRateChange() {
      updateDisplayRate();
    }

    rateBase.addEventListener('input', onRateChange);
    rateUnit.addEventListener('change', onRateChange);

    document.getElementById('calcFromGame').addEventListener('click', calculateRMBFromGame);
    document.getElementById('calcFromRMB').addEventListener('click', calculateGameFromRMB);

    updateDisplayRate();
  </script>

</body>
</html>
